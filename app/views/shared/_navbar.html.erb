<nav class="sticky top-0 z-50 w-full border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
  <div class="w-full flex h-14 items-center px-4 md:px-8">

    <%# Branding %>
    <div class="mr-4 flex">
      <%= link_to root_path, class: "mr-6 flex items-center space-x-2" do %>
        <%# Icon placeholder %>
        <%= image_tag "favicon-32x32.png", class: "h-8 w-8", alt: "Logo" %>
        <span class="font-bold">Blockchain Auth</span>
      <% end %>
    </div>

    <%# Desktop Menu (Left/Center) - Expandable if needed %>
    <div class="hidden md:flex flex-1">
      <%# Add main nav links here if any %>
    </div>

    <div class="flex flex-1 items-center justify-between space-x-2 md:justify-end">
      <div class="w-full flex-1 md:w-auto md:flex-none">
        <%# Search or other controls could go here %>
      </div>

      <%# Desktop User Block - Hidden on wallet page %>
      <% unless controller_name == 'wallet' %>
        <div class="hidden md:flex items-center gap-2">
        <% if Current.user %>
          <%# User Dropdown %>
          <div class="relative" data-navbar-target="dropdown">
            <button class="flex items-center gap-2 text-sm text-foreground hover:bg-accent px-3 py-2 rounded-md transition-colors"
                    data-action="click->navbar#toggleDropdown">
              <div class="h-8 w-8 rounded-full bg-primary/20 flex items-center justify-center text-primary text-xs font-semibold">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
              </div>
              <span class="font-medium font-mono text-xs"><%= Current.user.display_address %></span>
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
            </button>

            <%# Dropdown Menu %>
            <div class="hidden absolute right-0 mt-2 w-72 rounded-md border border-border bg-card shadow-lg" data-navbar-target="dropdownMenu">
              <div class="py-1">
                <div class="px-4 py-3 border-b border-border space-y-3">

                  <%# ETH Address with copy button %>
                  <div class="flex items-center justify-between gap-2  bg-muted/50 rounded-md">
                    <div class="flex items-center gap-2 flex-1 min-w-0">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-muted-foreground flex-shrink-0">
                        <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
                      </svg>
                      <p class="text-xs text-muted-foreground font-mono truncate" data-navbar-target="addressDisplay">
                        <%= Current.user.eth_address[0..5] %>...<%= Current.user.eth_address[-4..-1] %>
                      </p>
                    </div>
                    <button type="button"
                            class="p-1 hover:bg-accent rounded transition-colors flex-shrink-0"
                            data-action="click->navbar#copyAddress"
                            data-address="<%= Current.user.eth_address %>"
                            data-navbar-target="copyButton"
                            title="Copy address">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-navbar-target="copyIcon">
                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                      </svg>
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden text-green-500" data-navbar-target="checkIcon">
                        <polyline points="20 6 9 17 4 12"/>
                      </svg>
                    </button>
                  </div>

                  <%# Balance %>
                  <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                    <span class="text-xs font-medium" data-navbar-target="balance">
                      <span class="text-muted-foreground">Loading...</span>
                    </span>
                  </div>
                </div>
                <%= button_to session_path, method: :delete, class: "w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors flex items-center gap-2", form: { data: { turbo: "false" } } do %>
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                  <span>Disconnect</span>
                <% end %>
              </div>
            </div>
          </div>
        <% else %>
          <button type="button" class="btn text-sm h-9 px-4 cursor-pointer" data-action="click->wallet-login#connectAndSign">
            <span class="mr-1">âš¡</span> Sign In
          </button>
        <% end %>
        </div>
      <% end %>

       <%# Mobile Menu Button %>
      <button class="inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-9 py-2 w-9 px-0 md:hidden ml-2"
              type="button"
              data-action="click->navbar#toggleMobile">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg>
        <span class="sr-only">Toggle Menu</span>
      </button>
    </div>
  </div>

</nav>
